# Micro-Sniper

> **AI Native å¤šå¹³å°å†…å®¹ç›‘æ§ä¸åˆ†æç³»ç»Ÿ** - åŸºäºäº‘æµè§ˆå™¨ + Agent æ™ºèƒ½ä½“æ¶æ„

## ğŸ¯ é¡¹ç›®ç®€ä»‹

Micro-Sniper æ˜¯ä¸€ä¸ªåˆ›æ–°çš„ AI é©±åŠ¨å†…å®¹ç›‘æ§å¹³å°ï¼Œé‡‡ç”¨ **AI Native** è®¾è®¡ç†å¿µï¼Œä¸º Agent æ™ºèƒ½ä½“æä¾›å¤šå¹³å°å†…å®¹é‡‡é›†ã€åˆ†æå’Œç›‘æ§èƒ½åŠ›ã€‚

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- ğŸ¤– **AI Native æ¶æ„** - æ‰€æœ‰è¾“å‡ºå‡ä¸ºè‡ªç„¶è¯­è¨€ï¼ŒAgent å¯ç›´æ¥é˜…è¯»å’Œç†è§£
- ğŸ¯ **æ™ºèƒ½ç‹™å‡»æ‰‹** - åˆ›ä½œè€…ç›‘æ§ã€è¶‹åŠ¿åˆ†æã€çˆ†æ¬¾å†…å®¹æŒ–æ˜
- ğŸ”Œ **ç»Ÿä¸€è¿æ¥å™¨** - æ”¯æŒå°çº¢ä¹¦ã€å¾®ä¿¡å…¬ä¼—å·ç­‰å¤šå¹³å°
- ğŸ’¾ **ä»»åŠ¡ç³»ç»Ÿ** - å®Œæ•´çš„ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œæ—¥å¿—å¯è¿½æº¯
- ğŸ”„ **Cookie æŒä¹…åŒ–** - æ”¯æŒæ‰«ç ç™»å½•ã€Cookie ç™»å½•ï¼ŒçŠ¶æ€è‡ªåŠ¨ä¿å­˜
- âš¡ **æ··åˆæ¨¡å¼** - CDP ç›´è¿ + Agent è‡ªåŠ¨åŒ–ï¼Œæ€§èƒ½ä¸çµæ´»æ€§å…¼é¡¾

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### AI Native è®¾è®¡ç†å¿µ

ä¼ ç»Ÿç³»ç»Ÿè¾“å‡ºç»“æ„åŒ–æ•°æ®ï¼ŒAgent éœ€è¦è§£æå’Œç†è§£å­—æ®µå«ä¹‰ã€‚Micro-Sniper é‡‡ç”¨ **AI Native** è®¾è®¡ï¼š

```
ä¼ ç»Ÿæ–¹å¼ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    JSONè§£æ    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agent      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  {"total": 2, â”‚
â”‚             â”‚              â”‚   "results": []}
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AI Native æ–¹å¼ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ç›´æ¥é˜…è¯»    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agent      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  æˆåŠŸè·å– 2 ä¸ª â”‚
â”‚             â”‚              â”‚  åˆ›ä½œè€…çš„æ•°æ®  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**
- âœ… Agent ç›´æ¥é˜…è¯»è‡ªç„¶è¯­è¨€ï¼Œæ— éœ€è§£æ
- âœ… æ—¥å¿—åŒ…å«ï¼šä¸ºä»€ä¹ˆåšã€åšä»€ä¹ˆã€ç»“æœå¦‚ä½•ã€ä¸‹ä¸€æ­¥
- âœ… ç»“æœä»¥è‡ªç„¶è¯­è¨€æŠ¥å‘Šå‘ˆç°ï¼ŒAI å¯ç›´æ¥ç†è§£
- âœ… ä»»åŠ¡ä¸Šä¸‹æ–‡å®Œæ•´å¯è¿½æº¯

### æŠ€æœ¯æ ˆ

```
Webæ¡†æ¶:
  - Sanic (å¼‚æ­¥ Web æ¡†æ¶)
  - Tortoise-ORM (å¼‚æ­¥æ•°æ®åº“)

AI Agent:
  - DashScope (é˜¿é‡Œäº‘é€šä¹‰åƒé—®)
  - AgentBay (äº‘æµè§ˆå™¨ Agent)

æ•°æ®å­˜å‚¨:
  - PostgreSQL
  - Redis
```

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        API Layer                            â”‚
â”‚                    (Sanic REST API)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Task Service Layer                         â”‚
â”‚              (ä»»åŠ¡ç®¡ç† - AI Native æ ¸å¿ƒ)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚è¶‹åŠ¿åˆ†æAgent â”‚  â”‚åˆ›ä½œè€…ç›‘æ§Agent â”‚  â”‚  ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Connector Service                          â”‚
â”‚          (ç»Ÿä¸€çš„è¿æ¥å™¨ç®¡ç†å’Œè°ƒåº¦ä¸­å¿ƒ)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ å°çº¢ä¹¦è¿æ¥å™¨ â”‚  â”‚  å¾®ä¿¡è¿æ¥å™¨   â”‚  â”‚ é€šç”¨è¿æ¥å™¨   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AgentBay Cloud                            â”‚
â”‚                    (äº‘æµè§ˆå™¨ + Agent)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Session ç®¡ç†     Context æŒä¹…åŒ–    Browser å®ä¾‹     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
Micro-Sniper/
â”œâ”€â”€ api/                        # API æ¥å£å±‚
â”‚   â”œâ”€â”€ routes/                
â”‚   â”‚   â”œâ”€â”€ connectors.py      # è¿æ¥å™¨ç›¸å…³ API
â”‚   â”‚   â”œâ”€â”€ sniper.py          # ç‹™å‡»æ‰‹ä»»åŠ¡ API
â”‚   â”‚   â””â”€â”€ identity.py        # èº«ä»½è®¤è¯ API
â”‚   â””â”€â”€ schema/                # Pydantic æ•°æ®æ¨¡å‹
â”‚
â”œâ”€â”€ services/                  # æ ¸å¿ƒä¸šåŠ¡æœåŠ¡
â”‚   â”œâ”€â”€ connectors/            # è¿æ¥å™¨æœåŠ¡ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”‚   â”œâ”€â”€ base.py           # è¿æ¥å™¨åŸºç±»
â”‚   â”‚   â”œâ”€â”€ connector_service.py # è¿æ¥å™¨ç®¡ç†
â”‚   â”‚   â””â”€â”€ xiaohongshu.py    # å°çº¢ä¹¦è¿æ¥å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ sniper/                # ç‹™å‡»æ‰‹æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ xhs_creator.py    # åˆ›ä½œè€…ç›‘æ§ç‹™å‡»æ‰‹
â”‚   â”‚   â””â”€â”€ xhs_trend.py      # è¶‹åŠ¿åˆ†æç‹™å‡»æ‰‹
â”‚   â”‚
â”‚   â”œâ”€â”€ identity_service.py    # èº«ä»½è®¤è¯æœåŠ¡
â”‚   â””â”€â”€ image_service.py       # å›¾åƒå¤„ç†æœåŠ¡
â”‚
â”œâ”€â”€ models/                     # ORM æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ task.py                # ä»»åŠ¡æ¨¡å‹ï¼ˆAI Native è®¾è®¡ï¼‰
â”‚   â”œâ”€â”€ identity.py            # èº«ä»½è®¤è¯æ¨¡å‹
â”‚   â””â”€â”€ connectors.py          # è¿æ¥å™¨æ¨¡å‹
â”‚
â”œâ”€â”€ middleware/                 # Sanic ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ auth.py                # è®¤è¯ä¸­é—´ä»¶
â”‚   â””â”€â”€ exception_handler.py   # å¼‚å¸¸å¤„ç†
â”‚
â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”œâ”€â”€ config/                     # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ settings.py            # Pydantic é…ç½®
â”‚
â””â”€â”€ app.py                      # åº”ç”¨å…¥å£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.12+
- PostgreSQL 14+
- AgentBay API Key
- DashScope API Key (é˜¿é‡Œäº‘é€šä¹‰åƒé—®)

### å®‰è£…éƒ¨ç½²

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/your-org/Micro-Sniper.git
cd Micro-Sniper
```

2. **å®‰è£…ä¾èµ–**
```bash
# ä½¿ç”¨ poetry
poetry install

# æˆ–ä½¿ç”¨ pip
pip install -r requirements.txt
```

3. **ç¯å¢ƒé…ç½®**
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®
vim .env
```

å¿…è¦çš„ç¯å¢ƒå˜é‡ï¼š
```bash
# AgentBay é…ç½®
AGENTBAY_API_KEY=your-agentbay-api-key

# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://user:password@localhost/microsniper

# AI æ¨¡å‹é…ç½®
DASHSCOPE_API_KEY=your-dashscope-api-key

# åº”ç”¨é…ç½®
SECRET_KEY=your-secret-key
```

4. **å¯åŠ¨æœåŠ¡**
```bash
python -m app
```

5. **éªŒè¯å®‰è£…**
```bash
curl http://localhost:8000/health
```

## ğŸ¤– AI Native åŠŸèƒ½

### 1. ä»»åŠ¡ç³»ç»Ÿ (AI Native æ ¸å¿ƒ)

ä»»åŠ¡ç³»ç»Ÿé‡‡ç”¨ AI Native è®¾è®¡ï¼Œæ‰€æœ‰æ—¥å¿—å’Œç»“æœå‡ä¸ºè‡ªç„¶è¯­è¨€ï¼š

```python
from models.task import Task

# åˆ›å»ºä»»åŠ¡
task = await Task.create(
    source="system",
    source_id="system",
    task_type="creator_monitor"
)

# è®°å½•æ­¥éª¤ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰
await task.log_step(1, "è·å–åˆ›ä½œè€…ç¬”è®°åˆ—è¡¨", 
    {"action": "harvest_user_content", "creators_count": 2}, 
    {"result_summary": "æˆåŠŸè·å– 2 ä¸ªåˆ›ä½œè€…çš„æ•°æ®..."})

# å®Œæˆä»»åŠ¡ï¼ˆè‡ªç„¶è¯­è¨€æŠ¥å‘Šï¼‰
await task.complete({
    "report": """
    ç›‘æ§ä»»åŠ¡å®Œæˆ
    ============================================================
    ä»»åŠ¡ç›®æ ‡: ç›‘æ§ 2 ä¸ªåˆ›ä½œè€…è¿‘7å¤©çš„æ–°å†…å®¹
    æ‰§è¡Œç»“æœ: æˆåŠŸç›‘æ§ 2 ä¸ªåˆ›ä½œè€…
    å‘ç°å†…å®¹: å…±å‘ç° 5 ç¯‡è¿‘æœŸå‘å¸ƒçš„ç¬”è®°
    ...
    """
})
```

**AI å¯è¯»çš„æ—¥å¿—ç»“æ„ï¼š**
- **ä¸ºä»€ä¹ˆåš** - `purpose` / `step_purpose`
- **åšäº†ä»€ä¹ˆ** - `action` / å…·ä½“æ“ä½œ
- **ç»“æœå¦‚ä½•** - `result_summary` è‡ªç„¶è¯­è¨€æè¿°
- **ä¸‹ä¸€æ­¥** - `next_step` / `next_action`

### 2. åˆ›ä½œè€…ç›‘æ§ç‹™å‡»æ‰‹

ç›‘æ§æŒ‡å®šåˆ›ä½œè€…çš„æœ€æ–°å†…å®¹ï¼š

```python
from services.sniper.xhs_creator import CreatorSniper

# åˆå§‹åŒ–ç‹™å‡»æ‰‹
sniper = CreatorSniper(
    source_id="system",
    source="system",
    playwright=playwright
)

# æ‰§è¡Œç›‘æ§
task, report = await sniper.monitor_creators(
    creator_ids=["5c4c5848000000001200de55", "657f31eb000000003d036737"]
)

# æŠ¥å‘Šç¤ºä¾‹ï¼ˆAI å¯è¯»çš„è‡ªç„¶è¯­è¨€ï¼‰
print(report)
"""
==================================================================================================
                              ğŸ“Š åˆ›ä½œè€…ç›‘æ§æŠ¥å‘Š                              
                        ç”Ÿæˆæ—¶é—´: 2025-12-29 15:30:00                         
==================================================================================================
ğŸ“ˆ ç›‘æ§æ¦‚è§ˆ:
   â€¢ ç›‘æ§åˆ›ä½œè€…: 2/2
   â€¢ ç›‘æ§å‘¨æœŸ: è¿‘7å¤©
   â€¢ æ–°å¢ç¬”è®°: 5 ç¯‡

----------------------------------------------------------------------------------------------------

ğŸ‘¤ åˆ›ä½œè€… #1: å¥¶æ²¹ç±³Naomi
   ğŸ†” ID: 5c4c5848000000001200de55
   ğŸ“š æ€»ç¬”è®°æ•°: 7 ç¯‡
   âœ¨ è¿‘7æ—¥æ–°å¢: 3 ç¯‡

   ğŸ“… ä¸Šæ¬¡å‘å¸ƒ:
      â° æ—¶é—´: 2025-12-25 10:30:00
      ğŸ“ æ ‡é¢˜: æ–‡åˆ›å¼€ç®±ä¹‹ nebisuçˆ±æˆ‘ æˆ‘çˆ±nebisuğŸ˜‹
      ğŸ’¬ äº’åŠ¨: ğŸ‘41 â­12 ğŸ’¬5

   ğŸ‰ è¿‘7æ—¥æ–°å¢å†…å®¹ (3 ç¯‡):
      [1] ğŸ“… 2025-12-28 15:20:00
          ğŸ“ æ”¶ç¨¿/çº¦ç¨¿é¡»çŸ¥ 
          ğŸ’­ ğŸ‘67 â­8 ğŸ’¬2
...
"""
```

### 3. è¶‹åŠ¿åˆ†æç‹™å‡»æ‰‹

åˆ†æå…³é”®è¯çš„çˆ†æ¬¾è¶‹åŠ¿ï¼š

```python
from services.sniper.xhs_trend import XiaohongshuDeepAgent

# åˆå§‹åŒ–åˆ†æå™¨
analyzer = XiaohongshuDeepAgent(
    source_id="system",
    source="system",
    playwright=playwright,
    keywords="agenté¢è¯•"
)

# æ‰§è¡Œåˆ†æ
task, analysis = await analyzer.analyze_trends()

# åˆ†æç»“æœï¼ˆAI ç”Ÿæˆçš„è‡ªç„¶è¯­è¨€ï¼‰
print(analysis)
"""
åŸºäºå…³é”®è¯ã€Œagenté¢è¯•ã€çš„å°çº¢ä¹¦çˆ†æ¬¾åˆ†æï¼š

## æ ¸å¿ƒè§‚ç‚¹
1. æŠ€æœ¯é¢è¯•æ”»ç•¥å ä¸»å¯¼ï¼Œèšç„¦å¤§å‚é¢è¯•ç»éªŒ
2. é¢è¯•å‡†å¤‡ä»ã€Œç¡¬æŠ€èƒ½ã€è½¬å‘ã€Œè½¯æŠ€èƒ½ã€
3. AI å·¥å…·è¾…åŠ©é¢è¯•æˆä¸ºæ–°è¶‹åŠ¿

## å—ä¼—ç¾¤ä½“
- åˆçº§ç¨‹åºå‘˜ï¼šå¯»æ±‚é¢è¯•æŒ‡å¯¼å’Œç»éªŒåˆ†äº«
- èŒåœºè½¬å‹è€…ï¼šäº†è§£è¡Œä¸šé¢è¯•è¦æ±‚
- æŠ€æœ¯leadï¼šå…³æ³¨å›¢é˜Ÿé¢è¯•æŠ€å·§

## çˆ†æ¬¾åŸå› 
1. å®ç”¨æ€§å¼ºï¼šæä¾›å…·ä½“çš„é¢è¯•é¢˜å’Œè§£é¢˜æ€è·¯
2. æƒ…æ„Ÿå…±é¸£ï¼šåˆ†äº«å¤±è´¥å’ŒæˆåŠŸçš„çœŸå®ç»å†
3. ç´§è·Ÿçƒ­ç‚¹ï¼šç»“åˆ AIã€è¿œç¨‹å·¥ä½œç­‰æ–°è¶‹åŠ¿
...
"""
```

### 4. è¿æ¥å™¨æœåŠ¡

ç»Ÿä¸€çš„å¹³å°å†…å®¹æå–èƒ½åŠ›ï¼š

```python
from services.connector_service import ConnectorService
from models.connectors import PlatformType

connector_service = ConnectorService()

# 1. æå–å†…å®¹æ‘˜è¦ï¼ˆAgent åˆ†æï¼‰
async def extract_content():
    results = await connector_service.extract_summary_stream(
        urls=["https://www.xiaohongshu.com/explore/xxxx"],
        platform=PlatformType.XIAOHONGSHU,
        concurrency=3
    )
    async for result in results:
        print(result)

# 2. è·å–ç¬”è®°è¯¦æƒ…ï¼ˆå¿«é€Ÿæ¨¡å¼ï¼‰
async def get_note_details():
    details = await connector_service.get_note_details(
        urls=["https://www.xiaohongshu.com/explore/xxxx"],
        platform=PlatformType.XIAOHONGSHU,
        concurrency=3
    )
    return details

# 3. æ‰¹é‡é‡‡æ”¶ç”¨æˆ·å†…å®¹
async def harvest_user():
    content = await connector_service.harvest_user_content(
        platform=PlatformType.XIAOHONGSHU,
        creator_ids=["5c4c5848000000001200de55"],
        limit=100
    )
    return content
```

## ğŸ“Š API ç«¯ç‚¹

### ä»»åŠ¡ç®¡ç† API

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/sniper/xhs-creator` | POST | åˆ›å»ºåˆ›ä½œè€…ç›‘æ§ä»»åŠ¡ |
| `/sniper/xhs-trend` | POST | åˆ›å»ºè¶‹åŠ¿åˆ†æä»»åŠ¡ |
| `/sniper/task/<task_id>` | GET | è·å–ä»»åŠ¡è¯¦æƒ… |
| `/sniper/task/<task_id>/logs` | GET | è·å–ä»»åŠ¡æ—¥å¿— |
| `/sniper/tasks` | POST | æŸ¥è¯¢ä»»åŠ¡åˆ—è¡¨ |

### è¿æ¥å™¨ API

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/connectors/login` | POST | ç™»å½•ï¼ˆæ”¯æŒ Cookie/äºŒç»´ç ï¼‰ |
| `/connectors/extract` | POST | æå–å†…å®¹æ‘˜è¦ |
| `/connectors/notes/details` | POST | è·å–ç¬”è®°è¯¦æƒ… |
| `/connectors/harvest` | POST | æ‰¹é‡é‡‡æ”¶ç”¨æˆ·å†…å®¹ |
| `/connectors/search` | POST | æœç´¢å¹¶æå– |

### èº«ä»½è®¤è¯ API

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/identity/api-keys` | POST | åˆ›å»º API Key |
| `/health` | GET | å¥åº·æ£€æŸ¥ |

## ğŸ” èº«ä»½è®¤è¯

ç³»ç»Ÿä½¿ç”¨ Bearer Token è®¤è¯ï¼š

```bash
# è¯·æ±‚ç¤ºä¾‹
curl -X POST http://localhost:8000/sniper/xhs-trend \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "keywords": ["agenté¢è¯•"],
    "platform": "xiaohongshu"
  }'
```

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### AI Native vs ä¼ ç»Ÿæ¶æ„

| ç‰¹æ€§ | ä¼ ç»Ÿæ¶æ„ | AI Native æ¶æ„ |
|------|---------|----------------|
| æ•°æ®è¾“å‡º | ç»“æ„åŒ– JSON | è‡ªç„¶è¯­è¨€æ–‡æœ¬ |
| Agent ç†è§£ | éœ€è¦è§£æå­—æ®µ | ç›´æ¥é˜…è¯»ç†è§£ |
| æ—¥å¿—è®°å½• | ç®€è¦çŠ¶æ€ | å®Œæ•´ä¸Šä¸‹æ–‡ï¼ˆä¸ºä»€ä¹ˆ/åšä»€ä¹ˆ/ç»“æœ/ä¸‹ä¸€æ­¥ï¼‰ |
| ç»“æœå­˜å‚¨ | åˆ†æ•£çš„å­—æ®µ | ç»Ÿä¸€çš„è‡ªç„¶è¯­è¨€æŠ¥å‘Š |
| å¯è¿½æº¯æ€§ | éœ€è¦æ‹¼æ¥æ•°æ® | ç›´æ¥é˜…è¯»æ—¥å¿—å³å¯ |

### æ··åˆæ¨¡å¼æ¶æ„

ç³»ç»Ÿé‡‡ç”¨"æ··åˆæ¨¡å¼"æ¥å¹³è¡¡æ€§èƒ½å’Œçµæ´»æ€§ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä½ çš„ä»£ç                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                  â”‚
    å¿«é€Ÿæ¨¡å¼ï¼ˆCDP ç›´è¿ï¼‰                Agent æ¨¡å¼ï¼ˆè‡ªåŠ¨åŒ–ï¼‰
             â”‚                                  â”‚
    page.evaluate()                    agent.act_async()
             â”‚                                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Playwright CDP   â”‚         â”‚   AgentBay Agent    â”‚
    â”‚  ç›´æ¥å‘ JS å‘½ä»¤    â”‚         â”‚   AI åˆ†æ + æ‰§è¡Œ     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  AgentBay Browser  â”‚
                â”‚  (è¿œç¨‹ Chrome)     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸¤ç§æ¨¡å¼å¯¹æ¯”ï¼š**

| ç‰¹æ€§ | CDP ç›´è¿æ¨¡å¼ | Agent æ¨¡å¼ |
|------|-------------|-----------|
| é€Ÿåº¦ | âš¡ï¸ å¿« (~50ms) | ğŸ¢ æ…¢ (~1-3s) |
| ç”¨é€” | æ•°æ®æå–ã€ç®€å•æ“ä½œ | å¤æ‚äº¤äº’ã€å¼¹çª—å¤„ç† |
| å®ç° | `page.evaluate()` | `agent.act_async()` |
| æˆæœ¬ | ä½ | é«˜ï¼ˆAI æ¶ˆè€—ï¼‰ |

**ä½¿ç”¨åŸåˆ™ï¼š**
- ç®€å•æ“ä½œï¼ˆæå–æ•°æ®ã€ç‚¹å‡»ï¼‰â†’ CDP ç›´è¿
- å¤æ‚æ“ä½œï¼ˆå…³é—­å¼¹çª—ã€æ»šåŠ¨ã€æ™ºèƒ½äº¤äº’ï¼‰â†’ Agent

### Session vs Context

```
Sessionï¼ˆä¼šè¯ï¼‰ï¼š
  - ä¸´æ—¶çš„æµè§ˆå™¨å®ä¾‹
  - æ¯æ¬¡ä»»åŠ¡åˆ›å»ºï¼Œç”¨å®Œå³åˆ 
  - é€šè¿‡ agent_bay.create() åˆ›å»º
  - ç”Ÿå‘½å‘¨æœŸï¼šåˆ›å»º â†’ ä½¿ç”¨ â†’ åˆ é™¤

Contextï¼ˆä¸Šä¸‹æ–‡ï¼‰ï¼š
  - æŒä¹…åŒ–çš„æµè§ˆå™¨çŠ¶æ€ï¼ˆcookiesã€localStorageï¼‰
  - å¯ä»¥è¢«å¤šä¸ª Session å…±äº«
  - é€šè¿‡ context_id æ ‡è¯†
  - ç”Ÿå‘½å‘¨æœŸï¼šç™»å½•åˆ›å»º â†’ é•¿æœŸä¿å­˜ â†’ æ‰‹åŠ¨åˆ é™¤
```

**å·¥ä½œæµç¨‹ï¼š**
```
1. ç™»å½•æ—¶åˆ›å»º Context
   â””â”€â”€> ä¿å­˜ cookies ç­‰ç™»å½•æ€
   
2. æ¯æ¬¡ä»»åŠ¡åˆ›å»º Session
   â””â”€â”€> å…³è”åˆ°å·²å­˜åœ¨çš„ Context
   â””â”€â”€> ç»§æ‰¿ç™»å½•æ€
   
3. ä»»åŠ¡å®Œæˆåˆ é™¤ Session
   â””â”€â”€> Context ä¿æŒä¸å˜
   
4. ä¸‹æ¬¡ä»»åŠ¡ç»§ç»­ä½¿ç”¨åŒä¸€ Context
```

### å¹¶å‘æ¨¡å‹

**æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼š**
```
è¯·æ±‚ 1: agent_bay.create() â†’ session1 â†’ CDP è¿æ¥ 1 â†’ æ‰§è¡Œ â†’ åˆ é™¤
è¯·æ±‚ 2: agent_bay.create() â†’ session2 â†’ CDP è¿æ¥ 2 â†’ æ‰§è¡Œ â†’ åˆ é™¤
è¯·æ±‚ 3: agent_bay.create() â†’ session3 â†’ CDP è¿æ¥ 3 â†’ æ‰§è¡Œ â†’ åˆ é™¤
```

- æ¯ä¸ª session æœ‰ç‹¬ç«‹çš„è¿œç¨‹ browser
- æ¯ä¸ª CDP è¿æ¥æ˜¯ç‹¬ç«‹çš„ WebSocket
- æ— å…¨å±€ç“¶é¢ˆï¼Œæ”¯æŒé«˜å¹¶å‘

## ğŸ› ï¸ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„ç‹™å‡»æ‰‹æœåŠ¡

1. **åˆ›å»ºç‹™å‡»æ‰‹ç±»**

```python
# services/sniper/xhs_search.py
from services.connector_service import ConnectorService
from models.task import Task

class XHSSearchSniper:
    """å°çº¢ä¹¦æœç´¢ç‹™å‡»æ‰‹"""
    
    def __init__(self, source_id: str = "system", source: str = "system", playwright: Any = None):
        self.connector_service = ConnectorService(
            source=source,
            source_id=source_id,
            playwright=playwright
        )
        self.source = source
        self.source_id = source_id
    
    async def search_keywords(self, keywords: List[str]) -> tuple[Task, str]:
        """æœç´¢å…³é”®è¯å¹¶ç”ŸæˆæŠ¥å‘Š"""
        # åˆ›å»ºä»»åŠ¡
        task = await Task.create(
            source=source,
            source_id=source_id,
            task_type="keyword_search"
        )
        
        try:
            await task.start()
            
            # è®°å½•æ­¥éª¤
            await task.log_step(1, "æœç´¢å…³é”®è¯", 
                              {"keywords": keywords, "count": len(keywords)}, 
                              {"summary": f"å¼€å§‹æœç´¢ {len(keywords)} ä¸ªå…³é”®è¯"})
            
            # æ‰§è¡Œæœç´¢é€»è¾‘...
            
            # ç”Ÿæˆè‡ªç„¶è¯­è¨€æŠ¥å‘Š
            report = self.format_report(results)
            
            # å®Œæˆä»»åŠ¡
            await task.complete({"report": report})
            return task, report
            
        except Exception as e:
            await task.fail(str(e), task.progress)
            raise
```

2. **æ·»åŠ  API è·¯ç”±**

```python
# api/routes/sniper.py
@sniper_bp.post("/xhs-search")
async def create_search_task(request: Request):
    """åˆ›å»ºæœç´¢ä»»åŠ¡"""
    data = request.json
    keywords = data.get("keywords", [])
    
    from services.sniper.xhs_search import XHSSearchSniper
    background_task = asyncio.create_task(
        _run_search_task(request.app.ctx.playwright, keywords, auth_info)
    )
    
    return json(BaseResponse(
        code=ErrorCode.SUCCESS,
        message="æœç´¢ä»»åŠ¡å·²åˆ›å»º"
    ).model_dump())
```

### æ·»åŠ æ–°å¹³å°è¿æ¥å™¨

1. **ç»§æ‰¿ BaseConnector**

```python
from services.connectors.base import BaseConnector
from models.connectors import PlatformType

class TikTokConnector(BaseConnector):
    def __init__(self):
        super().__init__(platform_name=PlatformType.TIKTOK)
    
    def _build_context_id(self, source: str, source_id: str) -> str:
        return f"{self.platform_name.value}-context:{source}:{source_id}"
    
    async def extract_summary_stream(self, urls, **kwargs):
        """å®ç°æå–é€»è¾‘"""
        session = await self._get_browser_session(source, source_id)
        # ... CDP ç›´è¿æå–
        await self.agent_bay.delete(session, sync_context=False)
```

2. **æ³¨å†Œè¿æ¥å™¨**

```python
# åœ¨ connector_service.py ä¸­æ·»åŠ 
elif platform == PlatformType.TIKTOK:
    self._connectors[platform] = TikTokConnector()
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

```bash
# åº”ç”¨é…ç½®
APP_NAME=Micro-Sniper
DEBUG=false
HOST=0.0.0.0
PORT=8000

# æ•°æ®åº“
DATABASE_URL=postgresql://user:password@localhost/microsniper

# AgentBay
AGENTBAY_API_KEY=your-agentbay-key

# AI æ¨¡å‹
DASHSCOPE_API_KEY=your-dashscope-key

# å®‰å…¨
SECRET_KEY=your-secret-key
ENCRYPTION_KEY=your-aes-key
```

## ğŸ“ˆ æ€§èƒ½è€ƒè™‘

### å½“å‰æ¶æ„ä¼˜åŠ¿
- âœ… æ— å…¨å±€ç“¶é¢ˆï¼Œæ¯ä¸ªè¯·æ±‚ç‹¬ç«‹
- âœ… CDP è¿æ¥å¼€é”€å°ï¼ˆ~50msï¼‰
- âœ… æ··åˆæ¨¡å¼ï¼Œç®€å•æ“ä½œä¸èµ° Agent
- âœ… AI Nativeï¼Œå‡å°‘æ•°æ®è§£æå¼€é”€

### æ€§èƒ½å‚æ•°
- `concurrency`: å¹¶å‘æ•°æ§åˆ¶ï¼ˆå»ºè®® 3-10ï¼‰
- Session ç”¨å®Œå³åˆ ï¼Œæ— çŠ¶æ€ç®¡ç†å¼€é”€
- Context å¤ç”¨ï¼Œé¿å…é‡å¤ç™»å½•

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯

## ğŸ™‹â€â™‚ï¸ æ”¯æŒ

- æŠ€æœ¯æ”¯æŒï¼šyancyyu@lazymind.vip

---

**æ ¸å¿ƒä»·å€¼**ï¼šAI Native è®¾è®¡ï¼Œè®© Agent åƒäººç±»ä¸€æ ·é˜…è¯»å’Œç†è§£ä»»åŠ¡ï¼Œå®ç°çœŸæ­£çš„æ™ºèƒ½åŒ–å†…å®¹ç›‘æ§